<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8" />
  <title>Process Detector</title>
</head>
<body>

<h1>Process Detector</h1>

{% if not active %}
  <form method="post" action="/billing/checkout">
    <input type="email" name="email" placeholder="jij@bedrijf.nl" required>
    <button name="plan" value="basic">Basic</button>
    <button name="plan" value="pro">Pro</button>
  </form>
{% else %}
  <p>Ingelogd als {{ email }} ({{ plan|upper }})</p>
{% endif %}

<hr>

<form id="uploadForm">
  <input type="file" name="file" required {% if not active %}disabled{% endif %}>

  {% if is_pro %}
    <input type="number" name="rate" placeholder="â‚¬ per uur" value="60">
  {% else %}
    <p><b>â‚¬-impact is beschikbaar in Pro</b></p>
    <input type="hidden" name="rate" value="0">
  {% endif %}

  <button type="submit" {% if not active %}disabled{% endif %}>Analyseer</button>
</form>

{% if not is_pro %}
  <p style="color:red;">
    ðŸ‘‰ Upgrade naar <b>Pro</b> voor â‚¬-impact en analysegeschiedenis
  </p>
{% endif %}

{% if is_pro and history %}
  <h3>Analysegeschiedenis</h3>
  <ul>
    {% for h in history %}
      <li>
        {{ h.date }} â€”
        <a href="/download/{{ h.pdf }}">Download PDF</a>
      </li>
    {% endfor %}
  </ul>
{% endif %}

<script>
document.getElementById("uploadForm").onsubmit = async (e) => {
  e.preventDefault();
  const fd = new FormData(e.target);
  const res = await fetch("/upload", { method: "POST", body: fd });
  const data = await res.json();
  if (data.filename) {
    window.location = "/download/" + data.filename;
  }
};
</script>

</body>
</html>
