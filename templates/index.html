<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Prolixia ‚Äì App</title>
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; margin: 40px; color:#0f172a; scroll-behavior:smooth; }
    .card { max-width: 960px; padding: 28px; border: 1px solid #e5e7eb; border-radius: 16px; background:#fff; }
    .row { display:flex; gap:16px; flex-wrap: wrap; align-items:center; }
    .btn { padding: 12px 18px; border-radius: 10px; border:0; cursor:pointer; background:#0f172a; color:#fff; font-weight:800; text-decoration:none; display:inline-block; }
    .btn.secondary { background:#fff; color:#0f172a; border:2px solid #0f172a; }
    .btn.blue { background:#2563eb; }
    .muted { color:#64748b; }
    input { padding:10px; border-radius:10px; border:1px solid #e5e7eb; }
    a { color:#0f172a; text-decoration:none; }
    hr { border:none; border-top:1px solid #e5e7eb; margin: 24px 0; }
    .box { background:#f8fafc; border:1px solid #e2e8f0; padding:16px; border-radius:12px; }
    .box.warn { background:#fff7ed; border-color:#fed7aa; }
    .pill { padding:4px 10px; border-radius:999px; font-size:12px; font-weight:800; }
    .pill.high { background:#fee2e2; color:#991b1b; }
    .pill.medium { background:#ffedd5; color:#9a3412; }

    .kpi { cursor:pointer; padding:10px 14px; border-radius:10px; }
    .kpi:hover { background:#eef2ff; }

    /* paywall overlay */
    .overlay {
      position:fixed;
      inset:0;
      background:rgba(15,23,42,.55);
      display:none;
      align-items:center;
      justify-content:center;
      z-index:50;
    }
    .overlay .box {
      max-width:420px;
      background:#fff;
    }
  </style>
</head>
<body>
<div class="card">

  <div class="row" style="justify-content:space-between;">
    <h1 style="margin:0;">Prolixia</h1>
    <a href="/">‚Üê Landing</a>
  </div>

  <p class="muted">Support/SLA analyse: ontdek waar tickets blijven hangen.</p>

  <!-- ================= KPI SUMMARY ================= -->
  {% if metrics and metrics.sla_by_type %}
  <div class="box" style="margin-top:16px;">
    <b>üìå SLA-overzicht (samenvatting)</b>

    {% set comps = [] %}
    {% set risks = [] %}
    {% for t, v in metrics.sla_by_type.items() %}
      {% set _ = comps.append(v.compliance_pct) %}
      {% set _ = risks.append(v.monthly_risk_eur_est) %}
    {% endfor %}

    {% set avg_comp = (comps|sum / comps|length) if comps|length > 0 else 0 %}
    {% set total_risk = risks|sum %}

    <div class="row" style="margin-top:10px;">
      <a class="kpi" href="#sla-intelligence" data-paywall="true">
        <b>SLA-compliance</b><br>
        <span style="font-size:22px; font-weight:800;">{{ "%.1f"|format(avg_comp) }}%</span>
      </a>

      <a class="kpi" href="#actie-vereist" data-paywall="true">
        <b>Maandelijks risico</b><br>
        <span style="font-size:22px; font-weight:800;">‚Ç¨{{ "{:,.0f}".format(total_risk) }}</span>
      </a>

      <a class="kpi" href="#sla-trends" data-paywall="true">
        <b>Trend</b><br>
        üìä Bekijk ontwikkeling
      </a>
    </div>
  </div>
  {% endif %}

  <!-- ================= SLA DETAILS ================= -->
  {% if metrics and metrics.sla_by_type %}
  <div class="box" id="sla-intelligence" style="margin-top:16px;">
    <b>üìä SLA Intelligence per processtap</b>
    {% for t, v in metrics.sla_by_type.items() %}
      <div class="muted">{{ t.replace("_"," ").title() }} ‚Äî {{ v.compliance_pct }}%</div>
    {% endfor %}
  </div>
  {% endif %}

  <hr>

  <h3 id="subscribe">Start abonnement</h3>
  <div class="row">
    <form method="post" action="/subscribe/basic">
      <input type="email" name="email" required placeholder="jij@bedrijf.nl">
      <button class="btn secondary">Basic ‚Äì ‚Ç¨19</button>
    </form>
    <form method="post" action="/subscribe/pro">
      <input type="email" name="email" required placeholder="jij@bedrijf.nl">
      <button class="btn">Pro ‚Äì ‚Ç¨49</button>
    </form>
  </div>
</div>

<!-- ================= PAYWALL OVERLAY ================= -->
<div class="overlay" id="paywall">
  <div class="box warn">
    <b>üîí Premium inzicht</b>
    <p class="muted" style="margin-top:8px;">
      Gedetailleerde SLA-trends en klikbare analyses zijn beschikbaar in
      <b>Pro</b>.
    </p>
    <div class="row" style="margin-top:12px;">
      <a class="btn blue" href="#subscribe">Upgrade naar Pro ‚Üí</a>
      <button class="btn secondary" onclick="closePaywall()">Sluiten</button>
    </div>
  </div>
</div>

<script>
  const active = {{ "true" if active else "false" }};
  document.querySelectorAll("[data-paywall]").forEach(el => {
    el.addEventListener("click", e => {
      if (!active) {
        e.preventDefault();
        document.getElementById("paywall").style.display = "flex";
      }
    });
  });
  function closePaywall() {
    document.getElementById("paywall").style.display = "none";
  }
</script>
</body>
</html>
