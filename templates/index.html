<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8">
  <title>Process Detector</title>
</head>
<body>

<h1>Process Detector</h1>

{% if active %}
  <p>Ingelogd als <b>{{ email }}</b> â€” plan: <b>{{ plan|upper }}</b></p>
  <p>Gebruik: {{ used }} / {{ limit }}</p>
{% else %}
  <form method="post" action="/billing/checkout">
    <input type="email" name="email" placeholder="jij@bedrijf.nl" required>
    <button name="plan" value="basic">Start Basic</button>
    <button name="plan" value="pro">Start Pro</button>
  </form>
{% endif %}

<hr>

{% if active and not is_pro %}
  <div style="border:2px solid red; padding:10px; margin-bottom:20px;">
    <h3>ðŸš€ Upgrade naar Pro</h3>
    <p>Krijg â‚¬-impact, analysegeschiedenis en onbeperkte uploads.</p>
    <form method="post" action="/billing/upgrade">
      <button>Upgrade naar Pro</button>
    </form>
  </div>
{% endif %}

<form id="uploadForm">
  <input type="file" name="file" required {% if not active %}disabled{% endif %}>
  <button type="submit" {% if not active %}disabled{% endif %}>Analyseer</button>
</form>

<script>
document.getElementById("uploadForm").onsubmit = async (e) => {
  e.preventDefault();
  const fd = new FormData(e.target);
  const res = await fetch("/upload", { method: "POST", body: fd });
  const data = await res.json();
  if (data.filename) {
    window.location = "/download/" + data.filename;
  }
};
</script>

</body>
</html>
