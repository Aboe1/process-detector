<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8">
  <title>Process Detector</title>
</head>
<body>

<h1>Process Detector</h1>

{% if active %}
  <p>Ingelogd als {{ email }} ‚Äî plan: {{ plan|upper }}</p>
{% endif %}

<hr>

{% if is_pro and history|length >= 2 %}
<h3>Vergelijk analyses (Pro)</h3>

<form id="compareForm">
  <select name="a">
    {% for h in history %}
      <option value="{{ loop.index0 }}">{{ h.date }}</option>
    {% endfor %}
  </select>

  <select name="b">
    {% for h in history %}
      <option value="{{ loop.index0 }}">{{ h.date }}</option>
    {% endfor %}
  </select>

  <button type="submit">Vergelijk</button>
</form>

<div id="compareResult"></div>

<script>
document.getElementById("compareForm").onsubmit = async (e) => {
  e.preventDefault();
  const fd = new FormData(e.target);
  const res = await fetch("/compare", { method: "POST", body: fd });
  const data = await res.json();

  const el = document.getElementById("compareResult");
  if (data.improved) {
    el.innerHTML = `‚úÖ Verbetering: ${Math.abs(data.delta_hours)} uur (${Math.abs(data.delta_eur)} ‚Ç¨)`;
  } else {
    el.innerHTML = `‚ö†Ô∏è Verslechtering: +${data.delta_hours} uur (+${data.delta_eur} ‚Ç¨)`;
  }
};
</script>
{% elif active and not is_pro %}
<p style="color:red;">üëâ Upgrade naar Pro om analyses te vergelijken.</p>
{% endif %}

</body>
</html>
